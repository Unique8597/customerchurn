$schema: https://azuremlschemas.azureedge.net/latest/commandJob.schema.json
type: command
display_name: "Customer Churn Training Job"
experiment_name: customer-churn-experiment
# Directory containing train.py and dependencies
code: ../src

# ---------------------------
# Environment (Python + dependencies)
# ---------------------------
environment: 
  image: mcr.microsoft.com/azureml/openmpi4.1.0-ubuntu20.04:latest
  conda_file: ../.azureml/conda.yaml

environment_variables:
  TENANT_ID: ${{ secrets.TENANT_ID }}
  CLIENT_ID: ${{ secrets.CLIENT_ID }}
  CLIENT_SECRET: ${{ secrets.CLIENT_SECRET }}
  AZURE_STORAGE_ACCOUNT_NAME: ${{ secrets.AZURE_STORAGE_ACCOUNT_NAME }}
  AML_WORKSPACE: ${{ secrets.AML_WORKSPACE }}
  AZURE_STORAGE_CONTAINER_NAME: ${{ secrets.AZURE_STORAGE_CONTAINER_NAME }}
  AZURE_STORAGE_BLOB_NAME: ${{ secrets.AZURE_STORAGE_BLOB_NAME }}
  MLFLOW_TRACKING_URI : ${{ secrets.MLFLOW_TRACKING_URI }}
# ---------------------------
# Compute target
# ---------------------------
compute: cpu-cluster
resources:
  instance_count: 2

inputs:
  dataset:
    type: uri_folder
    path: ../src/preprocessed/ 
# ---------------------------
# Command to run
# ---------------------------
command: python model/utils.py --input ${{inputs.dataset}}

outputs:
  artifacts:
    type: uri_folder
    path: azureml://datastores/workspaceblobstore/paths/artifacts/